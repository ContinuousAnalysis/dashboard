{% set title = project.full_name ~ "@" ~ commit ~ " - RV Dashboard" %}
{% set heading = project.full_name %}
{% extends "base.html.j2" %}
{% block content %}
<nav class="breadcrumb muted">
  <a href="../../../index.html">Home</a> /
  <a href="../index.html">{{ project.full_name }}</a> /
  {{ commit }}
</nav>

<div class="card">
  <div><strong>Commit:</strong> <code>{{ commit }}</code></div>
  <div><strong>Unique locations:</strong> {{ rows|length }}</div>
  <div><strong>Flagged by both:</strong> {{ counts.both }}</div>
  <div><strong>PyMOP-only:</strong> {{ counts.pymop_only }}</div>
  <div><strong>DyLin-only:</strong> {{ counts.dylin_only }}</div>
</div>

<input id="search" type="search" placeholder="Filter by file/spec/messageâ€¦"/>

<table id="violations">
  <thead>
    <tr>
      <th>File</th>
      <th>Line</th>
      <th>Flagged by</th>
      <th>Specs</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td class="nowrap">{{ r.file }}</td>
      <td>{{ r.line }}</td>
      <td class="nowrap">{{ r.flagged_by }}</td>
      <td>{{ r.specs }}</td>
      <td><a class="nowrap" href="../../../violations/{{ project.slug }}/{{ commit }}/{{ r._id }}.html">Open</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  const input = document.getElementById('search');
  const rows = Array.from(document.querySelectorAll('#violations tbody tr'));
  input.addEventListener('input', () => {
    const q = input.value.toLowerCase();
    rows.forEach(tr => {
      tr.style.display = tr.innerText.toLowerCase().includes(q) ? '' : 'none';
    });
  });
</script>
{% endblock %}
