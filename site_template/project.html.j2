{% set title = project.full_name ~ " - RV Dashboard" %}
{% set heading = project.full_name %}
{% extends "base.html.j2" %}
{% block content %}
<nav class="breadcrumb muted">
  <a href="{{ root }}index.html">Home</a> / {{ project.full_name }}
</nav>

<div class="card">
  <div><strong>Commits analyzed:</strong> {{ commits|length }}</div>
  <div><strong>Total unique locations:</strong> {{ project.location_count }}</div>
  {% if project.csv_path %}
    <div><a href="{{ root }}{{ project.csv_path }}">Download original CSV</a></div>
  {% endif %}
</div>

<input id="search" type="search" placeholder="Filter commits by SHAâ€¦"/>

<table id="commits">
  <thead>
    <tr>
      <th>Commit</th>
      <th>Unique locations</th>
      <th>Flagged by both</th>
      <th>PyMOP-only</th>
      <th>DyLin-only</th>
    </tr>
  </thead>
  <tbody>
    {% for c in commits %}
    <tr>
      <td><a class="nowrap" href="{{ root }}projects/{{ project.slug }}/commits/{{ c.commit }}.html">{{ c.commit }}</a></td>
      <td>{{ c.locations }}</td>
      <td>{{ c.flagged_by_both }}</td>
      <td>{{ c.flagged_by_pymop_only }}</td>
      <td>{{ c.flagged_by_dylin_only }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  const input = document.getElementById('search');
  const rows = Array.from(document.querySelectorAll('#commits tbody tr'));
  input.addEventListener('input', () => {
    const q = input.value.toLowerCase();
    rows.forEach(tr => { tr.style.display = tr.innerText.toLowerCase().includes(q) ? '' : 'none'; });
  });
</script>
{% endblock %}